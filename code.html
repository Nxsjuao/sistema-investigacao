
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Investigação - Fichas Confidenciais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a1a2e;
            --secondary-color: #16213e;
            --accent-color: #0f3460;
            --highlight-color: #e94560;
            --text-color: #ffffff;
            --text-muted: #a0a0a0;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --danger-color: #d63031;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-color);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 255, 198, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card {
            background: rgba(22, 33, 62, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            border-color: var(--highlight-color);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8rem;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--highlight-color), #ff6b9d);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, var(--accent-color), #4ecdc4);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success-color), #55a3ff);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--warning-color), #ffa502);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger-color), #ff3742);
            color: white;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-color);
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--highlight-color);
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .input-field::placeholder {
            color: var(--text-muted);
        }

        .navbar {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--secondary-color);
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease-out;
            width: 90%;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .priority-high { border-left: 4px solid var(--danger-color); }
        .priority-medium { border-left: 4px solid var(--warning-color); }
        .priority-low { border-left: 4px solid var(--success-color); }

        .status-active { color: var(--success-color); }
        .status-pending { color: var(--warning-color); }
        .status-closed { color: var(--text-muted); }
        .status-archived { color: var(--danger-color); }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            overflow-x: auto;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            color: var(--text-muted);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab.active {
            color: var(--highlight-color);
            border-bottom-color: var(--highlight-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-input {
            padding-left: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--highlight-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -35px;
            top: 20px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--highlight-color);
            border: 3px solid var(--secondary-color);
        }

        .connection-map {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .connection-node {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto;
        }

        .connection-node:hover {
            transform: scale(1.1);
            border-color: var(--highlight-color);
            box-shadow: 0 0 30px rgba(233, 69, 96, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--highlight-color);
            display: block;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 3000;
            animation: slideInRight 0.3s ease-out;
            max-width: 400px;
        }

        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        .notification.warning { background: var(--warning-color); }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .evidence-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .evidence-item {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .evidence-item:hover {
            transform: scale(1.05);
            border-color: var(--highlight-color);
        }

        .tag {
            display: inline-block;
            background: var(--accent-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 2px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--highlight-color), #ff6b9d);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(233, 69, 96, 0.4);
            transition: all 0.3s ease;
            z-index: 1500;
        }

        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(233, 69, 96, 0.6);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1500;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(180deg);
        }

        .custom-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .custom-field-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .field-manager {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .field-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin: 5px 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: var(--highlight-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .modal-content {
                margin: 20px;
                padding: 20px;
                width: calc(100% - 40px);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-container {
                overflow-x: auto;
                white-space: nowrap;
            }

            .floating-action {
                bottom: 20px;
                right: 20px;
            }
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .hosting-info {
            background: rgba(0, 200, 100, 0.1);
            border: 1px solid rgba(0, 200, 100, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <i class="fas fa-user-secret text-2xl text-red-400"></i>
                <h1 class="text-xl font-bold">Sistema de Investigação</h1>
                <span class="text-sm bg-red-600 px-2 py-1 rounded">CONFIDENCIAL</span>
            </div>
            <div class="flex items-center space-x-4">
                <span id="currentTime" class="text-sm"></span>
                <button id="lockSystem" class="btn btn-danger btn-sm">
                    <i class="fas fa-lock"></i> Bloquear
                </button>
            </div>
        </div>
    </nav>

    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Search Section -->
        <div class="search-container mb-8">
            <div class="relative">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="globalSearch" class="input-field search-input" 
                       placeholder="Buscar pessoas, casos, evidências...">
            </div>
        </div>

        <!-- Statistics Dashboard -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="totalPersons">0</span>
                <div class="text-sm">Total de Pessoas</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="activeCases">0</span>
                <div class="text-sm">Casos Ativos</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalEvidence">0</span>
                <div class="text-sm">Evidências</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="investigationTime">0h</span>
                <div class="text-sm">Tempo de Investigação</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-container">
            <div class="tab active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="tab" data-tab="persons">
                <i class="fas fa-users"></i> Pessoas
            </div>
            <div class="tab" data-tab="evidence">
                <i class="fas fa-folder-open"></i> Evidências
            </div>
            <div class="tab" data-tab="timeline">
                <i class="fas fa-clock"></i> Timeline
            </div>
            <div class="tab" data-tab="connections">
                <i class="fas fa-project-diagram"></i> Conexões
            </div>
            <div class="tab" data-tab="reports">
                <i class="fas fa-chart-line"></i> Relatórios
            </div>
            <div class="tab" data-tab="fields">
                <i class="fas fa-cogs"></i> Campos
            </div>
            <div class="tab" data-tab="settings">
                <i class="fas fa-cog"></i> Configurações
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                        Casos Prioritários
                    </h3>
                    <div id="priorityCases">
                        <!-- Priority cases will be loaded here -->
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">
                        <i class="fas fa-clock text-blue-400"></i>
                        Atividade Recente
                    </h3>
                    <div id="recentActivity">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-calendar-alt text-green-400"></i>
                    Cronômetro de Investigação
                </h3>
                <div class="text-center">
                    <div class="text-4xl font-mono mb-4" id="investigationTimer">00:00:00</div>
                    <div class="space-x-4">
                        <button id="startTimer" class="btn btn-success">
                            <i class="fas fa-play"></i> Iniciar
                        </button>
                        <button id="pauseTimer" class="btn btn-warning">
                            <i class="fas fa-pause"></i> Pausar
                        </button>
                        <button id="resetTimer" class="btn btn-danger">
                            <i class="fas fa-stop"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Hosting Information -->
            <div class="hosting-info mt-6">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-cloud text-green-400"></i>
                    Informações de Hospedagem
                </h3>
                <p class="mb-2"><strong>Status:</strong> <span class="text-green-400">Sistema Local Ativo</span></p>
                <p class="mb-2"><strong>Armazenamento:</strong> Navegador Local (localStorage)</p>
                <p class="mb-4"><strong>Para hospedar online:</strong> Use GitHub Pages, Netlify, ou Vercel</p>
                <div class="text-sm text-gray-400">
                    <p>• GitHub Pages: Grátis, ideal para projetos estáticos</p>
                    <p>• Netlify: Deploy automático, formulários e funções</p>
                    <p>• Vercel: Performance otimizada, integração Git</p>
                </div>
            </div>
        </div>

        <!-- Persons Tab -->
        <div id="persons" class="tab-content">
            <div class="mb-6">
                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <div class="flex gap-4">
                        <button id="createPersonBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Nova Pessoa
                        </button>
                        <button id="importDataBtn" class="btn btn-secondary">
                            <i class="fas fa-upload"></i> Importar Dados
                        </button>
                        <button id="exportDataBtn" class="btn btn-success">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <select id="filterStatus" class="input-field">
                            <option value="">Todos os Status</option>
                            <option value="active">Ativo</option>
                            <option value="pending">Pendente</option>
                            <option value="closed">Fechado</option>
                            <option value="archived">Arquivado</option>
                        </select>
                        <select id="filterPriority" class="input-field">
                            <option value="">Todas as Prioridades</option>
                            <option value="high">Alta</option>
                            <option value="medium">Média</option>
                            <option value="low">Baixa</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="loading" id="personsLoading">
                <div class="spinner"></div>
                <div>Carregando pessoas...</div>
            </div>
            
            <div id="personsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Persons will be loaded here -->
            </div>
        </div>

        <!-- Evidence Tab -->
        <div id="evidence" class="tab-content">
            <div class="card">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-folder-open text-yellow-400"></i>
                    Galeria de Evidências
                </h3>
                <div class="mb-4">
                    <button id="addEvidenceBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Adicionar Evidência
                    </button>
                </div>
                <div class="evidence-gallery" id="evidenceGallery">
                    <!-- Evidence items will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Timeline Tab -->
        <div id="timeline" class="tab-content">
            <div class="card">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-clock text-blue-400"></i>
                    Timeline de Eventos
                </h3>
                <div class="mb-4">
                    <button id="addEventBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Adicionar Evento
                    </button>
                </div>
                <div class="timeline" id="timelineContainer">
                    <!-- Timeline events will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Connections Tab -->
        <div id="connections" class="tab-content">
            <div class="card">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-project-diagram text-purple-400"></i>
                    Mapa de Conexões
                </h3>
                <div class="connection-map" id="connectionMap">
                    <!-- Connection nodes will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">
                        <i class="fas fa-chart-pie text-green-400"></i>
                        Relatório por Status
                    </h3>
                    <canvas id="statusChart" width="400" height="200"></canvas>
                </div>
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">
                        <i class="fas fa-chart-bar text-blue-400"></i>
                        Relatório por Prioridade
                    </h3>
                    <canvas id="priorityChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-file-alt text-yellow-400"></i>
                    Gerar Relatórios
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button id="generateFullReport" class="btn btn-primary">
                        <i class="fas fa-file-pdf"></i> Relatório Completo
                    </button>
                    <button id="generateSummary" class="btn btn-secondary">
                        <i class="fas fa-file-text"></i> Resumo Executivo
                    </button>
                    <button id="generateAnalysis" class="btn btn-success">
                        <i class="fas fa-chart-line"></i> Análise Detalhada
                    </button>
                </div>
            </div>
        </div>

        <!-- Custom Fields Tab -->
        <div id="fields" class="tab-content">
            <div class="card">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-cogs text-purple-400"></i>
                    Gerenciador de Campos Personalizados
                </h3>
                
                <div class="field-manager">
                    <h4 class="font-bold mb-4">Adicionar Novo Campo</h4>
                    <form id="customFieldForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block mb-2">Nome do Campo:</label>
                                <input type="text" id="fieldName" class="input-field" 
                                       placeholder="Ex: Altura, Cor dos Olhos..." required>
                            </div>
                            <div>
                                <label class="block mb-2">Tipo de Campo:</label>
                                <select id="fieldType" class="input-field">
                                    <option value="text">Texto</option>
                                    <option value="textarea">Texto Longo</option>
                                    <option value="number">Número</option>
                                    <option value="date">Data</option>
                                    <option value="select">Lista de Opções</option>
                                    <option value="email">Email</option>
                                    <option value="tel">Telefone</option>
                                    <option value="url">URL/Link</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-2">Categoria:</label>
                                <select id="fieldCategory" class="input-field">
                                    <option value="personal">Informações Pessoais</option>
                                    <option value="contact">Contato</option>
                                    <option value="investigation">Investigação</option>
                                    <option value="physical">Características Físicas</option>
                                    <option value="background">Histórico</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="selectOptionsContainer" style="display: none;">
                            <label class="block mb-2">Opções (separadas por vírgula):</label>
                            <input type="text" id="selectOptions" class="input-field" 
                                   placeholder="Ex: Opção 1, Opção 2, Opção 3">
                        </div>
                        
                        <div>
                            <label class="block mb-2">Placeholder/Dica:</label>
                            <input type="text" id="fieldPlaceholder" class="input-field" 
                                   placeholder="Texto de ajuda para o usuário">
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="fieldRequired" class="mr-2">
                                Campo Obrigatório
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="fieldSearchable" class="mr-2" checked>
                                Incluir na Busca
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus"></i> Adicionar Campo
                        </button>
                    </form>
                </div>
                
                <div class="field-manager">
                    <h4 class="font-bold mb-4">Campos Existentes</h4>
                    <div id="existingFields">
                        <!-- Existing fields will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">
                        <i class="fas fa-shield-alt text-red-400"></i>
                        Configurações de Segurança
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block mb-2">Senha do Sistema:</label>
                            <input type="password" id="systemPassword" class="input-field" placeholder="Nova senha...">
                        </div>
                        <div>
                            <label class="block mb-2">Tempo de Bloqueio Automático (minutos):</label>
                            <input type="number" id="autoLockTime" class="input-field" value="30" min="1" max="1440">
                        </div>
                        <button id="updateSecurity" class="btn btn-danger">
                            <i class="fas fa-save"></i> Atualizar Segurança
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="text-lg font-bold mb-4">
                        <i class="fas fa-database text-blue-400"></i>
                        Backup e Restauração
                    </h3>
                    <div class="space-y-4">
                        <button id="createBackup" class="btn btn-success w-full">
                            <i class="fas fa-cloud-upload-alt"></i> Criar Backup
                        </button>
                        <button id="restoreBackup" class="btn btn-warning w-full">
                            <i class="fas fa-cloud-download-alt"></i> Restaurar Backup
                        </button>
                        <button id="clearAllData" class="btn btn-danger w-full">
                            <i class="fas fa-trash-alt"></i> Limpar Todos os Dados
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-palette text-purple-400"></i>
                    Personalização
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block mb-2">Tema:</label>
                        <select id="themeSelector" class="input-field">
                            <option value="dark">Escuro (Investigação)</option>
                            <option value="blue">Azul Profissional</option>
                            <option value="green">Verde Militar</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2">Fonte:</label>
                        <select id="fontSelector" class="input-field">
                            <option value="courier">Courier New</option>
                            <option value="arial">Arial</option>
                            <option value="roboto">Roboto</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2">Densidade:</label>
                        <select id="densitySelector" class="input-field">
                            <option value="compact">Compacta</option>
                            <option value="normal">Normal</option>
                            <option value="comfortable">Confortável</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="card mt-6">
                <h3 class="text-lg font-bold mb-4">
                    <i class="fas fa-cloud text-green-400"></i>
                    Guia de Hospedagem Online
                </h3>
                <div class="space-y-4">
                    <div class="hosting-info">
                        <h4 class="font-bold mb-2">GitHub Pages (Recomendado)</h4>
                        <ol class="list-decimal list-inside space-y-1 text-sm">
                            <li>Crie uma conta no GitHub</li>
                            <li>Crie um repositório público</li>
                            <li>Faça upload do arquivo index.html</li>
                            <li>Vá em Settings → Pages</li>
                            <li>Selecione "Deploy from branch" → main</li>
                            <li>Seu site estará em: username.github.io/repositorio</li>
                        </ol>
                    </div>
                    
                    <div class="hosting-info">
                        <h4 class="font-bold mb-2">Netlify (Mais Fácil)</h4>
                        <ol class="list-decimal list-inside space-y-1 text-sm">
                            <li>Acesse netlify.com</li>
                            <li>Arraste o arquivo index.html na área de deploy</li>
                            <li>Seu site estará online em segundos</li>
                            <li>URL personalizada gratuita disponível</li>
                        </ol>
                    </div>
                    
                    <div class="hosting-info">
                        <h4 class="font-bold mb-2">Vercel (Performance)</h4>
                        <ol class="list-decimal list-inside space-y-1 text-sm">
                            <li>Acesse vercel.com</li>
                            <li>Conecte com GitHub ou faça upload</li>
                            <li>Deploy automático e otimizado</li>
                            <li>CDN global incluído</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="floating-action" id="floatingAction">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Create/Edit Person Modal -->
    <div id="personModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-user-plus text-blue-400"></i>
                    <span id="modalTitle">Nova Pessoa</span>
                </h2>
                <button id="closePersonModal" class="text-gray-400 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="personForm" class="space-y-6">
                <div id="formFields">
                    <!-- Form fields will be generated dynamically -->
                </div>
                
                <input type="hidden" id="personId">
                
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelPersonForm" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Salvar Pessoa
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Person Detail Modal -->
    <div id="personDetailModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-user text-blue-400"></i>
                    Detalhes da Pessoa
                </h2>
                <div class="flex space-x-2">
                    <button id="editPersonDetail" class="btn btn-warning btn-sm">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button id="deletePersonDetail" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash"></i> Excluir
                    </button>
                    <button id="closePersonDetailModal" class="text-gray-400 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div id="personDetailContent">
                <!-- Person details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Evidence Modal -->
    <div id="evidenceModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-folder-plus text-yellow-400"></i>
                    Adicionar Evidência
                </h2>
                <button id="closeEvidenceModal" class="text-gray-400 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="evidenceForm" class="space-y-4">
                <div>
                    <label class="block mb-2">Título da Evidência:</label>
                    <input type="text" id="evidenceTitle" class="input-field" 
                           placeholder="Título descritivo da evidência" required>
                </div>
                <div>
                    <label class="block mb-2">Tipo:</label>
                    <select id="evidenceType" class="input-field">
                        <option value="document">Documento</option>
                        <option value="photo">Fotografia</option>
                        <option value="video">Vídeo</option>
                        <option value="audio">Áudio</option>
                        <option value="digital">Digital</option>
                        <option value="physical">Física</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2">Descrição:</label>
                    <textarea id="evidenceDescription" class="input-field" rows="3" 
                              placeholder="Descrição detalhada da evidência" required></textarea>
                </div>
                <div>
                    <label class="block mb-2">Arquivo/Imagem:</label>
                    <div class="border-2 border-dashed border-gray-400 rounded-lg p-8 text-center">
                        <img id="evidencePreview" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/defc5849-8b0c-4602-8e92-ecc49b38a55a.png" alt="Prévia da evidência - documento, foto ou representação visual do item coletado" class="mx-auto mb-4 rounded-lg" style="max-width: 300px;">
                        <input type="file" id="evidenceFile" accept="*/*" class="hidden">
                        <button type="button" onclick="document.getElementById('evidenceFile').click()" class="btn btn-secondary">
                            <i class="fas fa-upload"></i> Selecionar Arquivo
                        </button>
                    </div>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelEvidenceForm" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Salvar Evidência
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-plus-circle text-green-400"></i>
                    Adicionar Evento
                </h2>
                <button id="closeEventModal" class="text-gray-400 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="eventForm" class="space-y-4">
                <div>
                    <label class="block mb-2">Título do Evento:</label>
                    <input type="text" id="eventTitle" class="input-field" 
                           placeholder="Título do evento" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block mb-2">Data:</label>
                        <input type="date" id="eventDate" class="input-field" required>
                    </div>
                    <div>
                        <label class="block mb-2">Hora:</label>
                        <input type="time" id="eventTime" class="input-field">
                    </div>
                </div>
                <div>
                    <label class="block mb-2">Descrição:</label>
                    <textarea id="eventDescription" class="input-field" rows="3" 
                              placeholder="Descrição detalhada do evento" required></textarea>
                </div>
                <div>
                    <label class="block mb-2">Pessoas Envolvidas:</label>
                    <input type="text" id="eventPeople" class="input-field" 
                           placeholder="Nomes das pessoas envolvidas">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelEventForm" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Salvar Evento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Lock Screen Modal -->
    <div id="lockScreen" class="modal" style="background: rgba(0, 0, 0, 0.95);">
        <div class="modal-content text-center" style="max-width: 400px;">
            <i class="fas fa-lock text-6xl text-red-400 mb-6"></i>
            <h2 class="text-2xl font-bold mb-4">Sistema Bloqueado</h2>
            <p class="mb-6 text-gray-300">Digite a senha para desbloquear o sistema</p>
            <form id="unlockForm">
                <input type="password" id="unlockPassword" class="input-field mb-4" 
                       placeholder="Senha do sistema" required>
                <button type="submit" class="btn btn-success w-full">
                    <i class="fas fa-unlock"></i> Desbloquear
                </button>
            </form>
            <div class="mt-4 text-sm text-gray-400">
                <p>Senha padrão: admin</p>
            </div>
        </div>
    </div>

    <script>
        // Custom Fields Manager
        class CustomFieldsManager {
            constructor() {
                this.fields = JSON.parse(localStorage.getItem('investigation_custom_fields') || '[]');
                this.initializeDefaultFields();
            }

            initializeDefaultFields() {
                if (this.fields.length === 0) {
                    const defaultFields = [
                        { id: 'name', name: 'Nome Completo', type: 'text', category: 'personal', required: true, searchable: true, placeholder: 'Nome completo da pessoa' },
                        { id: 'code', name: 'Código de Identificação', type: 'text', category: 'investigation', required: false, searchable: true, placeholder: 'ID único (gerado automaticamente)' },
                        { id: 'birthdate', name: 'Data de Nascimento', type: 'date', category: 'personal', required: false, searchable: false, placeholder: '' },
                        { id: 'age', name: 'Idade', type: 'number', category: 'personal', required: false, searchable: false, placeholder: 'Calculado automaticamente', readonly: true },
                        { id: 'nationality', name: 'Nacionalidade', type: 'text', category: 'personal', required: false, searchable: true, placeholder: 'Nacionalidade' },
                        { id: 'document', name: 'CPF/RG', type: 'text', category: 'personal', required: false, searchable: true, placeholder: 'Documentos de identificação' },
                        { id: 'profession', name: 'Profissão', type: 'text', category: 'personal', required: false, searchable: true, placeholder: 'Profissão atual' },
                        { id: 'phone', name: 'Telefone', type: 'tel', category: 'contact', required: false, searchable: true, placeholder: 'Telefone de contato' },
                        { id: 'email', name: 'Email', type: 'email', category: 'contact', required: false, searchable: true, placeholder: 'Email de contato' },
                        { id: 'address', name: 'Endereço Completo', type: 'textarea', category: 'contact', required: false, searchable: true, placeholder: 'Endereço completo com CEP' },
                        { id: 'status', name: 'Status da Investigação', type: 'select', category: 'investigation', required: true, searchable: false, options: ['active', 'pending', 'closed', 'archived'] },
                        { id: 'priority', name: 'Prioridade', type: 'select', category: 'investigation', required: true, searchable: false, options: ['low', 'medium', 'high'] },
                        { id: 'category', name: 'Categoria', type: 'select', category: 'investigation', required: true, searchable: false, options: ['suspect', 'witness', 'victim', 'informant', 'person_of_interest'] },
                        { id: 'tags', name: 'Tags', type: 'text', category: 'investigation', required: false, searchable: true, placeholder: 'Ex: perigoso, fuga, armado' },
                        { id: 'physical', name: 'Características Físicas', type: 'textarea', category: 'physical', required: false, searchable: true, placeholder: 'Altura, peso, cor dos olhos, cabelo, tatuagens, cicatrizes...' },
                        { id: 'criminal', name: 'Histórico Criminal', type: 'textarea', category: 'background', required: false, searchable: true, placeholder: 'Antecedentes criminais, processos, condenações...' },
                        { id: 'associations', name: 'Associações Conhecidas', type: 'textarea', category: 'background', required: false, searchable: true, placeholder: 'Organizações, grupos, contatos conhecidos...' },
                        { id: 'social', name: 'Redes Sociais', type: 'textarea', category: 'contact', required: false, searchable: true, placeholder: 'Facebook, Instagram, Twitter, LinkedIn...' },
                        { id: 'notes', name: 'Observações Gerais', type: 'textarea', category: 'investigation', required: false, searchable: true, placeholder: 'Informações adicionais, comportamento, hábitos...' },
                        { id: 'danger', name: 'Nível de Periculosidade', type: 'select', category: 'investigation', required: false, searchable: false, options: ['low', 'medium', 'high', 'extreme'] }
                    ];
                    this.fields = defaultFields;
                    this.save();
                }
            }

            addField(fieldData) {
                const field = {
                    id: this.generateFieldId(fieldData.name),
                    name: fieldData.name,
                    type: fieldData.type,
                    category: fieldData.category,
                    required: fieldData.required || false,
                    searchable: fieldData.searchable || false,
                    placeholder: fieldData.placeholder || '',
                    options: fieldData.options || null,
                    createdAt: new Date().toISOString()
                };
                
                this.fields.push(field);
                this.save();
                return field;
            }

            updateField(fieldId, updates) {
                const index = this.fields.findIndex(f => f.id === fieldId);
                if (index !== -1) {
                    this.fields[index] = { ...this.fields[index], ...updates };
                    this.save();
                    return this.fields[index];
                }
                return null;
            }

            deleteField(fieldId) {
                const index = this.fields.findIndex(f => f.id === fieldId);
                if (index !== -1) {
                    this.fields.splice(index, 1);
                    this.save();
                    return true;
                }
                return false;
            }

            getField(fieldId) {
                return this.fields.find(f => f.id === fieldId);
            }

            getAllFields() {
                return this.fields;
            }

            getFieldsByCategory(category) {
                return this.fields.filter(f => f.category === category);
            }

            generateFieldId(name) {
                return name.toLowerCase()
                    .replace(/[^a-z0-9\s]/g, '')
                    .replace(/\s+/g, '_')
                    .substring(0, 30) + '_' + Date.now();
            }

            save() {
                localStorage.setItem('investigation_custom_fields', JSON.stringify(this.fields));
            }
        }

        // Enhanced Database with Custom Fields Support
        class InvestigationDB {
            constructor() {
                this.persons = JSON.parse(localStorage.getItem('investigation_persons') || '[]');
                this.evidence = JSON.parse(localStorage.getItem('investigation_evidence') || '[]');
                this.events = JSON.parse(localStorage.getItem('investigation_events') || '[]');
                this.settings = JSON.parse(localStorage.getItem('investigation_settings') || '{}');
                this.activity = JSON.parse(localStorage.getItem('investigation_activity') || '[]');
                this.customFields = new CustomFieldsManager();
                this.initializeDefaults();
            }

            initializeDefaults() {
                if (!this.settings.password) {
                    this.settings.password = '';
                    this.settings.autoLockTime = 30;
                    this.settings.theme = 'dark';
                    this.settings.font = 'courier';
                    this.settings.density = 'normal';
                    this.saveSettings();
                }
            }

            // Person operations with validation
            addPerson(person) {
                try {
                    const validatedPerson = this.validatePersonData(person);
                    validatedPerson.id = this.generateId();
                    validatedPerson.createdAt = new Date().toISOString();
                    validatedPerson.updatedAt = validatedPerson.createdAt;
                    
                    this.persons.push(validatedPerson);
                    this.savePersons();
                    this.addActivity('Pessoa adicionada', `${validatedPerson.name} foi adicionada ao sistema`);
                    return validatedPerson;
                } catch (error) {
                    throw new Error(`Erro ao adicionar pessoa: ${error.message}`);
                }
            }

            updatePerson(id, updatedData) {
                try {
                    const index = this.persons.findIndex(p => p.id === id);
                    if (index !== -1) {
                        const validatedData = this.validatePersonData(updatedData, false);
                        this.persons[index] = { 
                            ...this.persons[index], 
                            ...validatedData, 
                            updatedAt: new Date().toISOString() 
                        };
                        this.savePersons();
                        this.addActivity('Pessoa atualizada', `${this.persons[index].name} foi atualizada`);
                        return this.persons[index];
                    }
                    throw new Error('Pessoa não encontrada');
                } catch (error) {
                    throw new Error(`Erro ao atualizar pessoa: ${error.message}`);
                }
            }

            validatePersonData(data, isNew = true) {
                const validated = {};
                const requiredFields = this.customFields.getAllFields().filter(f => f.required);
                
                // Check required fields
                if (isNew) {
                    for (const field of requiredFields) {
                        if (!data[field.id] || data[field.id].toString().trim() === '') {
                            throw new Error(`Campo obrigatório "${field.name}" não preenchido`);
                        }
                    }
                }
                
                // Validate and clean data
                for (const [key, value] of Object.entries(data)) {
                    const field = this.customFields.getField(key);
                    if (field) {
                        validated[key] = this.validateFieldValue(value, field);
                    } else {
                        validated[key] = value; // Keep unknown fields for backward compatibility
                    }
                }
                
                return validated;
            }

            validateFieldValue(value, field) {
                if (!value && !field.required) return value;
                
                switch (field.type) {
                    case 'email':
                        if (value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                            throw new Error(`"${field.name}" deve ser um email válido`);
                        }
                        break;
                    case 'tel':
                        if (value && !/^[\d\s\-\(\)\+]+$/.test(value)) {
                            throw new Error(`"${field.name}" deve ser um telefone válido`);
                        }
                        break;
                    case 'url':
                        if (value && !/^https?:\/\/.+/.test(value)) {
                            throw new Error(`"${field.name}" deve ser uma URL válida`);
                        }
                        break;
                    case 'number':
                        if (value && isNaN(Number(value))) {
                            throw new Error(`"${field.name}" deve ser um número válido`);
                        }
                        break;
                }
                
                return value;
            }

            deletePerson(id) {
                const index = this.persons.findIndex(p => p.id === id);
                if (index !== -1) {
                    const person = this.persons[index];
                    this.persons.splice(index, 1);
                    this.savePersons();
                    this.addActivity('Pessoa removida', `${person.name} foi removida do sistema`);
                    return true;
                }
                return false;
            }

            getPerson(id) {
                return this.persons.find(p => p.id === id);
            }

            getAllPersons() {
                return this.persons;
            }

            // Evidence operations
            addEvidence(evidence) {
                evidence.id = this.generateId();
                evidence.createdAt = new Date().toISOString();
                this.evidence.push(evidence);
                this.saveEvidence();
                this.addActivity('Evidência adicionada', evidence.title);
                return evidence;
            }

            // Event operations
            addEvent(event) {
                event.id = this.generateId();
                event.createdAt = new Date().toISOString();
                this.events.push(event);
                this.saveEvents();
                this.addActivity('Evento adicionado', event.title);
                return event;
            }

            // Activity logging
            addActivity(type, description) {
                const activity = {
                    id: this.generateId(),
                    type,
                    description,
                    timestamp: new Date().toISOString()
                };
                this.activity.unshift(activity);
                if (this.activity.length > 100) {
                    this.activity = this.activity.slice(0, 100);
                }
                this.saveActivity();
            }

            // Enhanced search functionality
            search(query) {
                const results = {
                    persons: [],
                    evidence: [],
                    events: []
                };

                const lowerQuery = query.toLowerCase();
                const searchableFields = this.customFields.getAllFields().filter(f => f.searchable);

                results.persons = this.persons.filter(person => {
                    return searchableFields.some(field => {
                        const value = person[field.id];
                        return value && value.toString().toLowerCase().includes(lowerQuery);
                    });
                });

                results.evidence = this.evidence.filter(evidence => 
                    evidence.title.toLowerCase().includes(lowerQuery) ||
                    evidence.description?.toLowerCase().includes(lowerQuery) ||
                    evidence.type.toLowerCase().includes(lowerQuery)
                );

                results.events = this.events.filter(event => 
                    event.title.toLowerCase().includes(lowerQuery) ||
                    event.description?.toLowerCase().includes(lowerQuery) ||
                    event.people?.toLowerCase().includes(lowerQuery)
                );

                return results;
            }

            // Utility methods
            generateId() {
                return 'INV-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            }

            calculateAge(birthDate) {
                if (!birthDate) return '';
                try {
                    const today = new Date();
                    const birth = new Date(birthDate);
                    let age = today.getFullYear() - birth.getFullYear();
                    const monthDiff = today.getMonth() - birth.getMonth();
                    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                        age--;
                    }
                    return age;
                } catch (error) {
                    return '';
                }
            }

            // Save methods
            savePersons() {
                localStorage.setItem('investigation_persons', JSON.stringify(this.persons));
            }

            saveEvidence() {
                localStorage.setItem('investigation_evidence', JSON.stringify(this.evidence));
            }

            saveEvents() {
                localStorage.setItem('investigation_events', JSON.stringify(this.events));
            }

            saveActivity() {
                localStorage.setItem('investigation_activity', JSON.stringify(this.activity));
            }

            saveSettings() {
                localStorage.setItem('investigation_settings', JSON.stringify(this.settings));
            }

            // Backup and restore
            createBackup() {
                const backup = {
                    persons: this.persons,
                    evidence: this.evidence,
                    events: this.events,
                    settings: this.settings,
                    activity: this.activity,
                    customFields: this.customFields.getAllFields(),
                    timestamp: new Date().toISOString(),
                    version: '2.0'
                };
                return JSON.stringify(backup, null, 2);
            }

            restoreBackup(backupData) {
                try {
                    const data = JSON.parse(backupData);
                    this.persons = data.persons || [];
                    this.evidence = data.evidence || [];
                    this.events = data.events || [];
                    this.settings = data.settings || {};
                    this.activity = data.activity || [];
                    
                    if (data.customFields) {
                        this.customFields.fields = data.customFields;
                        this.customFields.save();
                    }
                    
                    this.savePersons();
                    this.saveEvidence();
                    this.saveEvents();
                    this.saveSettings();
                    this.saveActivity();
                    
                    return true;
                } catch (error) {
                    console.error('Erro ao restaurar backup:', error);
                    return false;
                }
            }

            clearAllData() {
                this.persons = [];
                this.evidence = [];
                this.events = [];
                this.activity = [];
                
                this.savePersons();
                this.saveEvidence();
                this.saveEvents();
                this.saveActivity();
                
                this.addActivity('Sistema limpo', 'Todos os dados foram removidos');
            }
        }

        // Main Application Class
        class InvestigationApp {
            constructor() {
                this.db = new InvestigationDB();
                this.timerInterval = null;
                this.timerSeconds = 0;
                this.isTimerRunning = false;
                this.autoLockTimer = null;
                this.isLocked = false;
                this.currentEditingPerson = null;
                
                this.initializeApp();
                this.bindEvents();
                this.startClock();
                this.loadDashboard();
                this.setupAutoLock();
            }

            initializeApp() {
                // Initialize with sample data if empty
                if (this.db.persons.length === 0) {
                    this.createSampleData();
                }
                
                // Update statistics
                this.updateStatistics();
                
                // Load various sections
                this.loadPersonsList();
                this.loadEvidenceGallery();
                this.loadTimeline();
                this.loadConnectionMap();
                this.loadCustomFieldsInterface();
                this.generateFormFields();
            }

            createSampleData() {
                // Add sample persons with custom fields
                const samplePersons = [
                    {
                        name: 'João Silva Santos',
                        document: '123.456.789-00',
                        birthdate: '1985-03-15',
                        profession: 'Empresário',
                        phone: '(11) 99999-1234',
                        email: 'joao@email.com',
                        address: 'Rua das Flores, 123 - São Paulo/SP',
                        status: 'active',
                        priority: 'high',
                        category: 'suspect',
                        tags: 'perigoso, fuga',
                        notes: 'Suspeito de fraude financeira. Evita contato com autoridades.',
                        danger: 'high'
                    },
                    {
                        name: 'Maria Oliveira Costa',
                        document: '987.654.321-00',
                        birthdate: '1990-07-22',
                        profession: 'Advogada',
                        phone: '(11) 88888-5678',
                        email: 'maria@escritorio.com',
                        address: 'Av. Paulista, 1000 - São Paulo/SP',
                        status: 'pending',
                        priority: 'medium',
                        category: 'witness',
                        tags: 'testemunha-chave',
                        notes: 'Testemunha importante do caso. Cooperativa com as investigações.',
                        danger: 'low'
                    },
                    {
                        name: 'Carlos Mendes Rocha',
                        document: '456.789.123-00',
                        birthdate: '1978-12-03',
                        profession: 'Contador',
                        phone: '(11) 77777-9012',
                        email: 'carlos@contabilidade.com',
                        address: 'Rua do Comércio, 456 - São Paulo/SP',
                        status: 'closed',
                        priority: 'low',
                        category: 'informant',
                        tags: 'informante, confiável',
                        notes: 'Forneceu informações valiosas sobre o esquema financeiro.',
                        danger: 'low'
                    }
                ];

                samplePersons.forEach(person => {
                    try {
                        this.db.addPerson(person);
                    } catch (error) {
                        console.error('Erro ao criar dados de exemplo:', error);
                    }
                });

                // Add sample evidence
                const sampleEvidence = [
                    {
                        title: 'Documento Financeiro Suspeito',
                        type: 'document',
                        description: 'Comprovante de transferência bancária irregular encontrado durante busca.'
                    },
                    {
                        title: 'Fotografia de Vigilância',
                        type: 'photo',
                        description: 'Imagem de câmera de segurança mostrando o suspeito no local do crime.'
                    },
                    {
                        title: 'Gravação Telefônica',
                        type: 'audio',
                        description: 'Conversa interceptada entre os envolvidos no esquema.'
                    }
                ];

                sampleEvidence.forEach(evidence => this.db.addEvidence(evidence));

                // Add sample events
                const sampleEvents = [
                    {
                        title: 'Primeiro Contato com Suspeito',
                        date: '2024-01-15',
                        time: '14:30',
                        description: 'Primeira abordagem do suspeito João Silva Santos.',
                        people: 'João Silva Santos, Investigador Principal'
                    },
                    {
                        title: 'Coleta de Evidências',
                        date: '2024-01-20',
                        time: '09:00',
                        description: 'Busca e apreensão de documentos no escritório do suspeito.',
                        people: 'Equipe de Investigação, João Silva Santos'
                    },
                    {
                        title: 'Depoimento da Testemunha',
                        date: '2024-01-25',
                        time: '16:00',
                        description: 'Coleta de depoimento da testemunha Maria Oliveira Costa.',
                        people: 'Maria Oliveira Costa, Investigador Sênior'
                    }
                ];

                sampleEvents.forEach(event => this.db.addEvent(event));
            }

            bindEvents() {
                // Tab navigation
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
                });

                // Modal controls
                this.bindModalEvents();
                
                // Button events
                this.bindButtonEvents();
                
                // Form submissions
                this.bindFormEvents();
                
                // Search and filter functionality
                this.bindSearchEvents();
                
                // Timer controls
                this.bindTimerEvents();
                
                // Lock system
                this.bindLockEvents();
                
                // Settings
                this.bindSettingsEvents();
                
                // Custom fields
                this.bindCustomFieldEvents();
                
                // Auto-save and shortcuts
                this.setupAutoSave();
                this.bindKeyboardShortcuts();
            }

            bindModalEvents() {
                const modals = ['personModal', 'personDetailModal', 'evidenceModal', 'eventModal'];
                modals.forEach(modalId => {
                    const closeBtn = document.getElementById(`close${modalId.charAt(0).toUpperCase() + modalId.slice(1, -5)}Modal`);
                    if (closeBtn) {
                        closeBtn.addEventListener('click', () => this.closeModal(modalId));
                    }
                });

                // Cancel buttons
                document.getElementById('cancelPersonForm')?.addEventListener('click', () => this.closeModal('personModal'));
                document.getElementById('cancelEvidenceForm')?.addEventListener('click', () => this.closeModal('evidenceModal'));
                document.getElementById('cancelEventForm')?.addEventListener('click', () => this.closeModal('eventModal'));
            }

            bindButtonEvents() {
                document.getElementById('createPersonBtn')?.addEventListener('click', () => this.showCreatePersonModal());
                document.getElementById('floatingAction')?.addEventListener('click', () => this.showCreatePersonModal());
                document.getElementById('addEvidenceBtn')?.addEventListener('click', () => this.showModal('evidenceModal'));
                document.getElementById('addEventBtn')?.addEventListener('click', () => this.showModal('eventModal'));
                document.getElementById('importDataBtn')?.addEventListener('click', () => this.importData());
                document.getElementById('exportDataBtn')?.addEventListener('click', () => this.exportData());
            }

            bindFormEvents() {
                document.getElementById('personForm')?.addEventListener('submit', (e) => this.handlePersonForm(e));
                document.getElementById('evidenceForm')?.addEventListener('submit', (e) => this.handleEvidenceForm(e));
                document.getElementById('eventForm')?.addEventListener('submit', (e) => this.handleEventForm(e));
                document.getElementById('customFieldForm')?.addEventListener('submit', (e) => this.handleCustomFieldForm(e));
            }

            bindSearchEvents() {
                document.getElementById('globalSearch')?.addEventListener('input', (e) => this.handleSearch(e.target.value));
                document.getElementById('filterStatus')?.addEventListener('change', () => this.applyFilters());
                document.getElementById('filterPriority')?.addEventListener('change', () => this.applyFilters());
            }

            bindTimerEvents() {
                document.getElementById('startTimer')?.addEventListener('click', () => this.startTimer());
                document.getElementById('pauseTimer')?.addEventListener('click', () => this.pauseTimer());
                document.getElementById('resetTimer')?.addEventListener('click', () => this.resetTimer());
            }

            bindLockEvents() {
                document.getElementById('lockSystem')?.addEventListener('click', () => this.lockSystem());
                document.getElementById('unlockForm')?.addEventListener('submit', (e) => this.handleUnlock(e));
            }

            bindSettingsEvents() {
                document.getElementById('updateSecurity')?.addEventListener('click', () => this.updateSecurity());
                document.getElementById('createBackup')?.addEventListener('click', () => this.createBackup());
                document.getElementById('restoreBackup')?.addEventListener('click', () => this.restoreBackup());
                document.getElementById('clearAllData')?.addEventListener('click', () => this.clearAllData());
                document.getElementById('themeToggle')?.addEventListener('click', () => this.toggleTheme());
                
                // Report generation
                document.getElementById('generateFullReport')?.addEventListener('click', () => this.generateReport('full'));
                document.getElementById('generateSummary')?.addEventListener('click', () => this.generateReport('summary'));
                document.getElementById('generateAnalysis')?.addEventListener('click', () => this.generateReport('analysis'));
            }

            bindCustomFieldEvents() {
                // Field type change handler
                document.getElementById('fieldType')?.addEventListener('change', (e) => {
                    const optionsContainer = document.getElementById('selectOptionsContainer');
                    if (optionsContainer) {
                        optionsContainer.style.display = e.target.value === 'select' ? 'block' : 'none';
                    }
                });
            }

            bindKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'n':
                                e.preventDefault();
                                this.showCreatePersonModal();
                                break;
                            case 's':
                                e.preventDefault();
                                if (this.isModalOpen('personModal')) {
                                    document.getElementById('personForm')?.dispatchEvent(new Event('submit'));
                                }
                                break;
                            case 'f':
                                e.preventDefault();
                                document.getElementById('globalSearch')?.focus();
                                break;
                            case 'l':
                                e.preventDefault();
                                this.lockSystem();
                                break;
                        }
                    }
                    
                    if (e.key === 'Escape') {
                        this.closeAllModals();
                    }
                });
            }

            setupAutoSave() {
                // Auto-save form data
                const observeFormFields = () => {
                    const formFields = document.querySelectorAll('#personForm input, #personForm textarea, #personForm select');
                    formFields.forEach(field => {
                        field.addEventListener('input', () => {
                            this.saveFormDraft();
                        });
                    });
                };

                // Initial setup and re-setup when form is regenerated
                observeFormFields();
                
                // Birth date calculation
                const
